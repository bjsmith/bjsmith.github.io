---
title: "Making a confidence interval ggplot2 `geom`"
author: "Ben Smith"
date: "2017-09-23"
output: html_document
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<link href="/rmarkdown-libs/plotlyjs/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotlyjs/plotly-latest.min.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>


<p>For evaluating posteriors in Bayesian analysis it is pretty common to draw a “Highest Density Interval” to indicate the zone of highest (consecutive) density within a distribution, which may be plotted in a scatter plot or a histogram or density plot or similar.</p>
<p>When working in ggplot, you’ll often add multiple layers to your graph in the form of “geoms”: for instance, a <code>geom_point</code> to show a scatterplot, which you could overlay with geom_abline to draw a trendline through the points.</p>
<p>But there’s no <code>geom</code> to draw any kind of confidence interval of a distribution on a graph. I suppose that wanting to see the density on a plot is a fairly niche thing.</p>
<p>I created a <code>geom_hdi</code> for use in ggplot. I briefly explain here how that happened; you can find the <a href="https://github.com/bjsmith/reversallearning/blob/master/visualization/geom_hdi.R">geom_hdi file on github</a>. Using <code>geom_hdi</code>, you can show the distribution at any arbitrary set. It has some functionality with plotly and works with multiple groups. Keep in mind I’ve developed this for my own use, so if you want to use it, you may have to tweak to improve for your own application to ensure it works correctly!</p>
<p>A word of warning: the “Highest Density Interval” is similar but not the same as a “Confidence Interval”. I’d advise against using <code>geom_hdi</code> to plot confidence intervals on your data as it may not represent exactly the same thing.</p>
<div id="inspiration" class="section level2">
<h2>Inspiration</h2>
<p>I used the <code>ggalt</code> package’s <a href="https://rud.is/b/2015/09/08/roll-your-own-stats-and-geoms-in-ggplot2-part-1-splines/">xspline</a> <a href="https://rud.is/b/2015/09/08/roll-your-own-stats-and-geoms-in-ggplot2-part-1-splines/">tutorial</a> to get going. It was simple enough to copy the xspline package and go.</p>
<p>There were minimal changes needed here.</p>
</div>
<div id="creating-your-own-ggplot-geom" class="section level2">
<h2>Creating your own ggplot <code>geom</code></h2>
<p>Let me describe how I created <code>geom_hdi</code>. You can follow along the steps to create your own <code>geom</code>.</p>
<div id="drawing-the-basic-hdi" class="section level3">
<h3>Drawing the basic HDI</h3>
<p>First of all, I took a look at some basic data:</p>
<pre class="r"><code>library(ggplot2)
set.seed(42)
dat&lt;-data.frame(&quot;x&quot;=c(rnorm(1000,0,1)))

ggplot(dat, aes(x=x)) +
   geom_histogram(binwidth=0.1)</code></pre>
<p><img src="/post/geom_hdi_for_ggplot2_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>So far, so good. How would we do a 95% HDI in this data? Before we dive in and create the <code>geom</code>, let’s draw it manually. We can use this code later to build the <code>geom</code> itself. <code>geom_segment</code> is a good basic, flexible geom which would allow us to draw a line. We can specify <code>x</code>, <code>y</code>, <code>xend</code>, and <code>yend</code> to control the precise look of the line.</p>
<p>But before we draw the HDI we need to know where to put it! The <code>hBayesDM</code> package has a suitable HDI calculator, so we’ll use that.</p>
<pre class="r"><code>dat.hdi&lt;-hBayesDM::HDIofMCMC(dat$x)</code></pre>
<pre><code>## 
## This is package &#39;modeest&#39; written by P. PONCET.
## For a complete list of functions, use &#39;library(help = &quot;modeest&quot;)&#39; or &#39;help.start()&#39;.</code></pre>
<p>Cool cool. And now pass it in to our graph. I’m happy enough to put it right on the x-axis:</p>
<pre class="r"><code>ggplot(dat, aes(x=x)) +
   geom_histogram(binwidth=0.1)+
  geom_segment(x=dat.hdi[1],xend=dat.hdi[2],y=0,yend=0)</code></pre>
<p><img src="/post/geom_hdi_for_ggplot2_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>That’s a little hard to see, so we can draw it with some appropriate properties:</p>
<pre class="r"><code>ggplot(dat, aes(x=x)) +
   geom_histogram(binwidth=0.1)+
  geom_segment(x=dat.hdi[1],xend=dat.hdi[2],y=0,yend=0,color=&quot;blue&quot;,size=2,lineend=&quot;round&quot;)</code></pre>
<p><img src="/post/geom_hdi_for_ggplot2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Seems good. Now, let’s say we want to do this with a whole bunch of graphs; maybe we want multiple HDIs on each graph, pertaining to different groups, and we want the properties of the line to automatically follow the properties (e.g., color) we set for different groups.</p>
<p>How can we encapsulate this functionality in a single <code>geom</code>?</p>
</div>
</div>
<div id="writing-the-geom." class="section level2">
<h2>Writing the geom.</h2>
<p>Here is what I have created. This has been taken right from the excellent guide <a href="https://rud.is/b/2015/09/08/roll-your-own-stats-and-geoms-in-ggplot2-part-1-splines/">here</a>. If you find it helpful, you can compare the <code>geom_xspline</code> code there with my <code>geom_hdi</code> to work out on your own what you’d need to modify to create your own.</p>
<p>There are just two functions and two wrapper calls to create the necessary <code>ggproto</code> objects we need to do to get the <code>geom</code> off the ground. One gives you the “<code>geom</code>” specification and the other gives you the <code>stat</code> specification.</p>
<pre class="r"><code>geom_hdi &lt;- function(mapping = NULL, data = NULL, stat = &quot;hdi&quot;,
                         position = &quot;identity&quot;, na.rm = TRUE, show.legend = NA,
                         inherit.aes = TRUE,
                     credible_mass=0.95, ...) {
  layer(
  `geom` = GeomHdi,
    mapping = mapping,
    data = data,
    stat = stat,
    position = position,
    show.legend = show.legend,
    inherit.aes = inherit.aes,
    params = list(credible_mass=credible_mass,
                  ...)
  )
}

GeomHdi &lt;- ggproto(&quot;GeomHdi&quot;, GeomSegment,
                       required_aes = c(&quot;x&quot;),
                       default_aes = aes(colour = &quot;black&quot;, size = 0.5, linetype = 1, alpha = NA)
)

stat_hdi &lt;- function(mapping = NULL, data = NULL, `geom` = &quot;segment&quot;,
                         position = &quot;identity&quot;, na.rm = TRUE, show.legend = NA, inherit.aes = TRUE,
                     credible_mass=0.95, ...) {
  layer(
    stat = StatHdi,
    data = data,
    mapping = mapping,
    `geom` = `geom`,
    position = position,
    show.legend = show.legend,
    inherit.aes = inherit.aes,
    params = list(credible_mass=credible_mass,
                  ...
    )
  )
}

StatHdi &lt;- ggproto(&quot;StatHdi&quot;, Stat,
                       
                       required_aes = c(&quot;x&quot;),
                       
                       compute_group = function(self, data, scales, params,
                                                credible_mass=0.95) {
                         require(hBayesDM)
                         hdi.data&lt;-HDIofMCMC(data$x,credible_mass)
                         data.frame(x=hdi.data[1],xend=hdi.data[2],y=0,yend=0)
                       }
)</code></pre>
<p>To go from <code>geom_xspline</code> to <code>geom_hdi</code>, I followed these steps:</p>
<ol style="list-style-type: decimal">
<li>went through and replaced all mentions of “xspline” with the name of my <code>geom</code>, hdi, taking care to do a <em>case-sensitive</em> replace.</li>
<li>then replaced all mentions of “XSpline” with “Hdi”, following convention to capitalize where appropriate. One thing that tripped me up is that for some reason, the <code>geom</code> wouldn’t generate correctly when I spelled with three capital letters, “HDI”! I am not sure why this was, but it was no great sacrifice to go with the ‘camelcase’ “HDI” style.</li>
<li>had to replace each of the custom arguments here with my own. <code>geom_hdi</code> has just one custom argument, <code>credible_mass</code>. If you are creating your own <code>geom</code> from this, all you’d need to do is find whereever I mention <code>credible_mass</code> here and replace it with your own argument or set of arguments.</li>
<li>The easiest way to build a new <code>geom</code> is to build on top of a more basic <code>geom</code>. For instance, my <code>geom</code> above is built on <code>geom_segment</code>; that is set in the <code>geom</code> argument in the <code>stat_hdi</code> function. <code>geom_xspline</code>, on the other hand, was built on top of <code>geom_line</code> and passed ‘line’ into the <code>geom</code> argument of the equivalent <code>stat_xspline</code> function. When building your own <code>geom</code>, pick whichever more basic element suits you and build on top of that.</li>
<li>Finally, I modified the <code>compute_group</code> function near the end to transform the arguments passed into my own <code>geom_hdi</code> into arguments that would draw an HDI using the more basic <code>geom_segment</code>. I used the <code>hBayesDM::HDIofMCMC</code> function to transform x values into an HDI. By default, this is a 95% HDI, but you can set whichever values you like. At the end of the <code>compute_group</code> function, you want to pass a data frame that will go straight to the more basic <code>geom</code> to draw.</li>
</ol>
</div>
<div id="result" class="section level2">
<h2>Result</h2>
<p>This is already better than the geom we hand-drew. It can now be used to draw in HDIs for multiple groups:</p>
<pre class="r"><code>set.seed(42)
 heights.usa&lt;-data.frame(&quot;height&quot;=c(rnorm(10000,176,7),rnorm(10000,162,6)),
                 &quot;people&quot;=c(rep(&quot;Men&quot;,10000),rep(&quot;Women&quot;,10000)))

#https://biology.stackexchange.com/questions/9730/what-is-the-standard-deviation-of-adult-human-heights-for-males-and-females
#https://en.wikipedia.org/wiki/List_of_average_human_height_worldwide

height.plot&lt;-ggplot(heights.usa, aes(x=height, group=people, fill=factor(people),color=factor(people))) +
 geom_freqpoly(binwidth=1)+
 geom_hdi(aes(color=people),lineend=&quot;round&quot;,size=2,credible_mass=0.95,alpha=0.8)+
 labs(title=&quot;US adult height distribution by gender\nCount per 10,000 adults&quot;,x=&quot;height (cm)&quot;)

height.plot</code></pre>
<p><img src="/post/geom_hdi_for_ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>With a bit of work, we could have the function stagger these hdis if you didn’t want them lying on top of each other.</p>
<p>However, my priority was to get this looking nice in plotly! This required a little extra work.</p>
</div>
<div id="modification-for-plotly" class="section level2">
<h2>Modification for plotly</h2>
<p>The plotly documentation itself describes <a href="https://plotly-book.cpsievert.me/translating-custom-ggplot2-geoms.html#fig:xspline">how to modify your custom geoms to work in polotly</a>. Plotly graphs are pretty darn cool; take a look at this:</p>
<pre class="r"><code> plotly::ggplotly(height.plot)</code></pre>
<pre><code>## Warning: We recommend that you use the dev version of ggplot2 with `ggplotly()`
## Install it with: `devtools::install_github(&#39;hadley/ggplot2&#39;)`</code></pre>
<pre><code>## Warning in geom2trace.default(dots[[1L]][[1L]], dots[[2L]][[1L]], dots[[3L]][[1L]]): geom_GeomHdi() has yet to be implemented in plotly.
##   If you&#39;d like to see this geom implemented,
##   Please open an issue with your example code at
##   https://github.com/ropensci/plotly/issues</code></pre>
<pre><code>## Warning in geom2trace.default(dots[[1L]][[2L]], dots[[2L]][[1L]], dots[[3L]][[1L]]): geom_GeomHdi() has yet to be implemented in plotly.
##   If you&#39;d like to see this geom implemented,
##   Please open an issue with your example code at
##   https://github.com/ropensci/plotly/issues</code></pre>
<div id="2bc0309a71fa" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="2bc0309a71fa">{"x":{"data":[{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,0,0,0,0,0,0,0,1,0,0,0,1,1,6,10,7,16,18,37,42,62,74,123,145,166,201,250,311,363,419,377,460,507,605,547,539,596,555,504,484,444,394,339,254,270,214,154,135,92,88,47,51,33,20,13,6,6,3,6,2,1,0,0,0,0,1,0],"text":["count:   0<br />height: 140<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 141<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 142<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 143<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 144<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 145<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 146<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 147<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 148<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 149<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 150<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 151<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 152<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 153<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 154<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  10<br />height: 155<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   7<br />height: 156<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  16<br />height: 157<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  18<br />height: 158<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  37<br />height: 159<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  42<br />height: 160<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  62<br />height: 161<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  74<br />height: 162<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 123<br />height: 163<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 145<br />height: 164<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 166<br />height: 165<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 201<br />height: 166<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 250<br />height: 167<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 311<br />height: 168<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 363<br />height: 169<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 419<br />height: 170<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 377<br />height: 171<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 460<br />height: 172<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 507<br />height: 173<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 605<br />height: 174<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 547<br />height: 175<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 539<br />height: 176<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 596<br />height: 177<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 555<br />height: 178<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 504<br />height: 179<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 484<br />height: 180<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 444<br />height: 181<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 394<br />height: 182<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 339<br />height: 183<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 254<br />height: 184<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 270<br />height: 185<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 214<br />height: 186<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 154<br />height: 187<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 135<br />height: 188<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  92<br />height: 189<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  88<br />height: 190<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  47<br />height: 191<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  51<br />height: 192<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  33<br />height: 193<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  20<br />height: 194<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  13<br />height: 195<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 196<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 197<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   3<br />height: 198<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 199<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   2<br />height: 200<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 201<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 202<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 203<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 204<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 205<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 206<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 207<br />people: Men<br />factor(people): Men<br />factor(people): Men"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Men","legendgroup":"Men","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,2,2,7,12,10,21,22,45,70,106,123,182,226,263,328,386,459,534,571,635,628,705,670,591,578,549,442,463,295,266,207,175,139,101,63,40,37,20,10,8,4,3,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:   0<br />height: 140<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 141<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 142<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   7<br />height: 143<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  12<br />height: 144<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 145<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  21<br />height: 146<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  22<br />height: 147<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  45<br />height: 148<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  70<br />height: 149<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 106<br />height: 150<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 123<br />height: 151<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 182<br />height: 152<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 226<br />height: 153<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 263<br />height: 154<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 328<br />height: 155<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 386<br />height: 156<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 459<br />height: 157<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 534<br />height: 158<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 571<br />height: 159<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 635<br />height: 160<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 628<br />height: 161<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 705<br />height: 162<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 670<br />height: 163<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 591<br />height: 164<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 578<br />height: 165<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 549<br />height: 166<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 442<br />height: 167<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 463<br />height: 168<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 295<br />height: 169<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 266<br />height: 170<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 207<br />height: 171<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 175<br />height: 172<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 139<br />height: 173<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 101<br />height: 174<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  63<br />height: 175<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  40<br />height: 176<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  37<br />height: 177<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  20<br />height: 178<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 179<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   8<br />height: 180<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   4<br />height: 181<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   3<br />height: 182<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 183<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 184<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 185<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 186<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 187<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 188<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 189<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 190<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 191<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 192<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 193<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 194<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 195<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 196<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 197<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 198<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 199<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 200<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 201<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 202<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 203<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 204<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 205<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 206<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 207<br />people: Women<br />factor(people): Women<br />factor(people): Women"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Women","legendgroup":"Women","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"name":"Men","legendgroup":"Men","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"name":"Women","legendgroup":"Women","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"US adult height distribution by gender<br />Count per 10,000 adults","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[136.1,210.9],"ticktext":["140","160","180","200"],"tickvals":[140,160,180,200],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"height (cm)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-35.25,740.25],"ticktext":["0","200","400","600"],"tickvals":[0,200,400,600],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"count","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.93503937007874},"annotations":[{"text":"factor(people)","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest"},"source":"A","attrs":{"2bc057fe4dc3":{"x":{},"fill":{},"colour":{},"type":"ggplotly"},"2bc078a36a56":{"colour":{},"x":{},"fill":{},"colour.1":{}}},"cur_data":"2bc057fe4dc3","visdat":{"2bc057fe4dc3":["function (y) ","x"],"2bc078a36a56":["function (y) ","x"]},"config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<p>So you might notice here that my <code>geom_hdi</code> doesn’t display! That’ll take a little extra work - just one more function!</p>
<pre class="r"><code>to_basic.GeomHdi&lt;-function (data, prestats_data, layout, params, p, ...) 
{
  require(tidyr)

  #x positions                      
  d&lt;-tidyr::gather(data,xposinline,x,x:xend)
  
  #draw in appropriate y positions
  d$y&lt;-0
  dline&lt;-d

  structure(dline, class = unique(c(&quot;GeomPath&quot;, class(dline))))
}</code></pre>
<p>You want that function name to start with <code>to_basic.</code> followed by the name of the ggproto object you created above, mine being <code>GeomHdi</code>. Everything in that function is designed to transform the GeomHDI into a format that plotly can recognize.</p>
<p>Unfortunately, plotly doesn’t have support for GeomSegment, so I was unable to pass the code above directly to plotly. However, plotly does support geom_path. The format for geom_path is slightly different. For this, we’d create one row in the data for each <em>point</em>, not each line.</p>
<p>A little transformation with <code>tidyr::gather</code> will do that trick to get the x start position and finish position into the same line. The y positions would potentially get more complicated, but in my case, because I was placing every HDI right on <code>y=0</code>, I could just add in one line setting every y position to 0.</p>
<p>Let’s try that ggplotly HDI again:</p>
<pre class="r"><code> plotly::ggplotly(height.plot)</code></pre>
<div id="2bc0477fd08e" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="2bc0477fd08e">{"x":{"data":[{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,0,0,0,0,0,0,0,1,0,0,0,1,1,6,10,7,16,18,37,42,62,74,123,145,166,201,250,311,363,419,377,460,507,605,547,539,596,555,504,484,444,394,339,254,270,214,154,135,92,88,47,51,33,20,13,6,6,3,6,2,1,0,0,0,0,1,0],"text":["count:   0<br />height: 140<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 141<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 142<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 143<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 144<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 145<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 146<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 147<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 148<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 149<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 150<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 151<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 152<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 153<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 154<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  10<br />height: 155<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   7<br />height: 156<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  16<br />height: 157<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  18<br />height: 158<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  37<br />height: 159<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  42<br />height: 160<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  62<br />height: 161<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  74<br />height: 162<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 123<br />height: 163<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 145<br />height: 164<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 166<br />height: 165<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 201<br />height: 166<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 250<br />height: 167<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 311<br />height: 168<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 363<br />height: 169<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 419<br />height: 170<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 377<br />height: 171<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 460<br />height: 172<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 507<br />height: 173<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 605<br />height: 174<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 547<br />height: 175<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 539<br />height: 176<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 596<br />height: 177<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 555<br />height: 178<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 504<br />height: 179<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 484<br />height: 180<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 444<br />height: 181<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 394<br />height: 182<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 339<br />height: 183<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 254<br />height: 184<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 270<br />height: 185<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 214<br />height: 186<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 154<br />height: 187<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 135<br />height: 188<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  92<br />height: 189<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  88<br />height: 190<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  47<br />height: 191<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  51<br />height: 192<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  33<br />height: 193<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  20<br />height: 194<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  13<br />height: 195<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 196<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 197<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   3<br />height: 198<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 199<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   2<br />height: 200<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 201<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 202<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 203<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 204<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 205<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 206<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 207<br />people: Men<br />factor(people): Men<br />factor(people): Men"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Men","legendgroup":"Men","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,2,2,7,12,10,21,22,45,70,106,123,182,226,263,328,386,459,534,571,635,628,705,670,591,578,549,442,463,295,266,207,175,139,101,63,40,37,20,10,8,4,3,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:   0<br />height: 140<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 141<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 142<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   7<br />height: 143<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  12<br />height: 144<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 145<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  21<br />height: 146<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  22<br />height: 147<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  45<br />height: 148<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  70<br />height: 149<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 106<br />height: 150<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 123<br />height: 151<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 182<br />height: 152<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 226<br />height: 153<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 263<br />height: 154<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 328<br />height: 155<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 386<br />height: 156<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 459<br />height: 157<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 534<br />height: 158<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 571<br />height: 159<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 635<br />height: 160<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 628<br />height: 161<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 705<br />height: 162<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 670<br />height: 163<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 591<br />height: 164<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 578<br />height: 165<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 549<br />height: 166<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 442<br />height: 167<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 463<br />height: 168<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 295<br />height: 169<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 266<br />height: 170<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 207<br />height: 171<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 175<br />height: 172<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 139<br />height: 173<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 101<br />height: 174<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  63<br />height: 175<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  40<br />height: 176<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  37<br />height: 177<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  20<br />height: 178<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 179<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   8<br />height: 180<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   4<br />height: 181<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   3<br />height: 182<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 183<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 184<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 185<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 186<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 187<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 188<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 189<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 190<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 191<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 192<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 193<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 194<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 195<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 196<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 197<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 198<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 199<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 200<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 201<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 202<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 203<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 204<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 205<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 206<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 207<br />people: Women<br />factor(people): Women<br />factor(people): Women"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Women","legendgroup":"Women","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[162.525346987616,190.013985618547],"y":[0,0],"text":"people: Men<br />height: 162.5253<br />people: Men<br />factor(people): Men<br />factor(people): Men","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(248,118,109,0.8)","dash":"solid"},"hoveron":"points","name":"Men","legendgroup":"Men","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[150.012508338659,173.725197436994],"y":[0,0],"text":"people: Women<br />height: 150.0125<br />people: Women<br />factor(people): Women<br />factor(people): Women","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,191,196,0.8)","dash":"solid"},"hoveron":"points","name":"Women","legendgroup":"Women","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"US adult height distribution by gender<br />Count per 10,000 adults","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[136.1,210.9],"ticktext":["140","160","180","200"],"tickvals":[140,160,180,200],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"height (cm)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-35.25,740.25],"ticktext":["0","200","400","600"],"tickvals":[0,200,400,600],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"count","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.93503937007874},"annotations":[{"text":"factor(people)","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest"},"source":"A","attrs":{"2bc060aad628":{"x":{},"fill":{},"colour":{},"type":"ggplotly"},"2bc06fd20dac":{"colour":{},"x":{},"fill":{},"colour.1":{}}},"cur_data":"2bc060aad628","visdat":{"2bc060aad628":["function (y) ","x"],"2bc06fd20dac":["function (y) ","x"]},"config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<p>Getting there! But hover over our HDIs: the printed x-coordinates are broken. Wouldn’t it be nice to show the actual HDI coordinates on that hover? Yes it would! So we can edit the data <code>hovertext</code> property to display that. We use the params array to find what the x axis is called (it might not always be called “x”)</p>
<pre class="r"><code>to_basic.GeomHdi&lt;-function (data, prestats_data, layout, params, p, ...) 
{
  require(tidyr)
  #put a confidence interval into the hovertext
  data$hovertext&lt;-apply(data,1,
                        function(r){
                          sub(paste0(params$hoverTextAes[[&quot;x&quot;]],&quot;: -?\\d+(.\\d+)?(e\\d+)?&quot;),
                              paste0(params$hoverTextAes[[&quot;x&quot;]],&quot;: [&quot;,signif(as.numeric(r[[&quot;x&quot;]]),4),&quot;, &quot;,
                                     signif(as.numeric(r[[&quot;xend&quot;]],4)),&quot;]&quot;),r[[&quot;hovertext&quot;]])
                        })
  #x positions                      
  d&lt;-tidyr::gather(data,xposinline,x,x:xend)
  
  #draw in appropriate y positions
  d$y&lt;-0
  dline&lt;-d

  structure(dline, class = unique(c(&quot;GeomPath&quot;, class(dline))))
}</code></pre>
<p>The hovertext transform uses regex to convert the default hovertext that <code>plotly</code> creates for points on a line into hovertext which describes a density interval.</p>
<pre class="r"><code> plotly::ggplotly(height.plot)</code></pre>
<div id="2bc0d57b15b" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="2bc0d57b15b">{"x":{"data":[{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,0,0,0,0,0,0,0,1,0,0,0,1,1,6,10,7,16,18,37,42,62,74,123,145,166,201,250,311,363,419,377,460,507,605,547,539,596,555,504,484,444,394,339,254,270,214,154,135,92,88,47,51,33,20,13,6,6,3,6,2,1,0,0,0,0,1,0],"text":["count:   0<br />height: 140<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 141<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 142<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 143<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 144<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 145<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 146<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 147<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 148<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 149<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 150<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 151<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 152<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 153<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 154<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  10<br />height: 155<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   7<br />height: 156<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  16<br />height: 157<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  18<br />height: 158<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  37<br />height: 159<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  42<br />height: 160<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  62<br />height: 161<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  74<br />height: 162<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 123<br />height: 163<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 145<br />height: 164<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 166<br />height: 165<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 201<br />height: 166<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 250<br />height: 167<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 311<br />height: 168<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 363<br />height: 169<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 419<br />height: 170<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 377<br />height: 171<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 460<br />height: 172<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 507<br />height: 173<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 605<br />height: 174<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 547<br />height: 175<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 539<br />height: 176<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 596<br />height: 177<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 555<br />height: 178<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 504<br />height: 179<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 484<br />height: 180<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 444<br />height: 181<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 394<br />height: 182<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 339<br />height: 183<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 254<br />height: 184<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 270<br />height: 185<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 214<br />height: 186<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 154<br />height: 187<br />people: Men<br />factor(people): Men<br />factor(people): Men","count: 135<br />height: 188<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  92<br />height: 189<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  88<br />height: 190<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  47<br />height: 191<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  51<br />height: 192<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  33<br />height: 193<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  20<br />height: 194<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:  13<br />height: 195<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 196<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 197<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   3<br />height: 198<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   6<br />height: 199<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   2<br />height: 200<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 201<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 202<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 203<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 204<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 205<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   1<br />height: 206<br />people: Men<br />factor(people): Men<br />factor(people): Men","count:   0<br />height: 207<br />people: Men<br />factor(people): Men<br />factor(people): Men"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Men","legendgroup":"Men","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207],"y":[0,2,2,7,12,10,21,22,45,70,106,123,182,226,263,328,386,459,534,571,635,628,705,670,591,578,549,442,463,295,266,207,175,139,101,63,40,37,20,10,8,4,3,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:   0<br />height: 140<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 141<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   2<br />height: 142<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   7<br />height: 143<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  12<br />height: 144<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 145<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  21<br />height: 146<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  22<br />height: 147<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  45<br />height: 148<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  70<br />height: 149<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 106<br />height: 150<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 123<br />height: 151<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 182<br />height: 152<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 226<br />height: 153<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 263<br />height: 154<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 328<br />height: 155<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 386<br />height: 156<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 459<br />height: 157<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 534<br />height: 158<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 571<br />height: 159<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 635<br />height: 160<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 628<br />height: 161<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 705<br />height: 162<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 670<br />height: 163<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 591<br />height: 164<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 578<br />height: 165<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 549<br />height: 166<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 442<br />height: 167<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 463<br />height: 168<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 295<br />height: 169<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 266<br />height: 170<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 207<br />height: 171<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 175<br />height: 172<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 139<br />height: 173<br />people: Women<br />factor(people): Women<br />factor(people): Women","count: 101<br />height: 174<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  63<br />height: 175<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  40<br />height: 176<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  37<br />height: 177<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  20<br />height: 178<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:  10<br />height: 179<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   8<br />height: 180<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   4<br />height: 181<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   3<br />height: 182<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 183<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   1<br />height: 184<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 185<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 186<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 187<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 188<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 189<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 190<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 191<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 192<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 193<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 194<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 195<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 196<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 197<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 198<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 199<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 200<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 201<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 202<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 203<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 204<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 205<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 206<br />people: Women<br />factor(people): Women<br />factor(people): Women","count:   0<br />height: 207<br />people: Women<br />factor(people): Women<br />factor(people): Women"],"type":"scatter","mode":"lines","line":{"width":1.88976377952756,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Women","legendgroup":"Women","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[162.525346987616,190.013985618547],"y":[0,0],"text":"people: Men<br />height: [162.5, 190.014]<br />people: Men<br />factor(people): Men<br />factor(people): Men","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(248,118,109,0.8)","dash":"solid"},"hoveron":"points","name":"Men","legendgroup":"Men","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[150.012508338659,173.725197436994],"y":[0,0],"text":"people: Women<br />height: [150, 173.725]<br />people: Women<br />factor(people): Women<br />factor(people): Women","type":"scatter","mode":"lines","line":{"width":7.55905511811024,"color":"rgba(0,191,196,0.8)","dash":"solid"},"hoveron":"points","name":"Women","legendgroup":"Women","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.7625570776256,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":"US adult height distribution by gender<br />Count per 10,000 adults","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[136.1,210.9],"ticktext":["140","160","180","200"],"tickvals":[140,160,180,200],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"height (cm)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-35.25,740.25],"ticktext":["0","200","400","600"],"tickvals":[0,200,400,600],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"count","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.93503937007874},"annotations":[{"text":"factor(people)","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest"},"source":"A","attrs":{"2bc09195e56":{"x":{},"fill":{},"colour":{},"type":"ggplotly"},"2bc0608064c4":{"colour":{},"x":{},"fill":{},"colour.1":{}}},"cur_data":"2bc09195e56","visdat":{"2bc09195e56":["function (y) ","x"],"2bc0608064c4":["function (y) ","x"]},"config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"cloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1}},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":{"render":[{"code":"function(el, x) { var ctConfig = crosstalk.var('plotlyCrosstalkOpts').set({\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.2,\"selected\":{\"opacity\":1}}); }","data":null}]}}</script>
<p>Now our overtext displays the higest density interval.</p>
</div>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>That should give you a good start towards modifying <code>geom_hdi</code> for your own purposes or perhaps writing your own geom.</p>
</div>
